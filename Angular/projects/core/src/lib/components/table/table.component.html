<div class="content" fxLayout="column">

  <div class="table-container" fxLayout="column" (scroll)="onTableScroll($event)">
    <div class="table-scroll" class="table-container-class" (scroll)="onTableScroll($event)">
      <table mat-table [dataSource]="datasource" #baseTable matSort (scroll)="onTableScroll($event)">

        <ng-container *ngFor="let column of columns" matColumnDef={{column.columnName}}>
          <th [class]="[column.columnWidth, column.paddingColumn]" mat-header-cell *matHeaderCellDef>
            {{column.columnName}}</th>
          <td [class]="[column.columnWidth, column.paddingColumn]" mat-cell *matCellDef="let item">
            <ng-container>

              <div *ngIf="column.type == 'icon' && getIcons(item, column) != undefined"
                [class]="[column.columnWidth, column.cssClass]">
                <fa-icon [ngStyle]="{
                      color: getIconColor(item, column),
                      padding: '2px 5px 0 0',
                      'font-size': '16px'
                    }" [icon]="[
                      getIcons(item, column)[0],
                      getIcons(item, column)[1]
                    ]" (click)="onItemClick(item, column)">
                </fa-icon>
              </div>

              <div *ngIf="column.type == 'object' || column.type == 'text'" fxLayout="row"
                (click)="onItemClick(item, column)" [class]="[column.columnWidth]">
                <div *ngIf="hasIcons(item, column)">
                  <div *ngIf="hasProperty(item, column)">
                    <fa-icon [ngStyle]="{
                          color: getIconColor(item, column),
                          padding: '2px 5px 0 0'
                        }" [icon]="[
                          getIcons(item, column)[0],
                          getIcons(item, column)[1]
                        ]">
                    </fa-icon>
                  </div>
                </div>
                <span *ngIf="hasProperty(item, column)">{{
                    getProperty(item, column) | textWidth: column.columnWidth:column.type
                  }}</span>
              </div>

              <div *ngIf="column.type == 'image'" fxLayoutGap="10px" fxLayout="row">
                <img [src]="getImageUrl(item, column)" [class]="column.cssClass" />
                <div *ngIf="hasProperty(item, column)" [ngStyle]="{ 'padding-top': '6px' }">
                  {{ getProperty(item, column) | textWidth: column.columnWidth:column.type }}
                </div>
              </div>
            </ng-container>
          </td>
        </ng-container>

        <ng-container *ngIf="showViewAction != null" matColumnDef="view">
          <th class="th-width-130 content-align" mat-header-cell *matHeaderCellDef>
            Action
          </th>
          <td class="th-width-130 content-align" mat-cell *matCellDef="let item">
            <div [ngStyle]="{
                  color: '#f26522',
                  'font-size': '12px',
                  'font-weight': '600'
                }">
              View
              <fa-icon [ngStyle]="{ color: '#f26522' }" [icon]="['fas', 'arrow-circle-right']"></fa-icon>
            </div>
          </td>
        </ng-container>

        <ng-container *ngIf="buttonData != null" matColumnDef="action">
          <th class="th-width-80 content-align" mat-header-cell *matHeaderCellDef>
            Action
          </th>
          <td class="th-width-80 content-align" mat-cell *matCellDef="let item">
            <div *ngIf="item?.applicationStatus == 'Draft'; else active">
              <button class="continue-setup-button" (click)="$event.stopPropagation(); onButtonClick(item)"
                mat-stroked-button>
                <span style="font-size: 12px">Continue setup</span>
              </button>
            </div>

            <ng-template #active>
              <button mat-icon-button [matMenuTriggerFor]="menu" (click)="$event.stopPropagation()"
                class="action-button">
                <fa-icon [icon]="['fas', 'ellipsis-h']"></fa-icon>
              </button>
            </ng-template>

            <mat-menu #menu="matMenu" xPosition="before">
              <div *ngFor="let button of buttonData.data; last as last">
                <button class="menu-button" fxLayoutAlign="start center" (click)="button.action(item)" mat-menu-item>
                  <fa-icon [icon]="[button.iconLibrary, button.iconName]"
                    [ngStyle]="{ color: '#404140', 'font-size': '12px' }">
                  </fa-icon>
                  <span class="font-size" [ngStyle]="{
                        padding: '0px 0px 0px 10px',
                        color: '#404140'
                      }">{{ button.label }}</span>
                </button>
              </div>
            </mat-menu>
          </td>
        </ng-container>

        <ng-container *ngIf="showDeleteAction != null" matColumnDef="delete">
          <th class="th-width-30 content-align" mat-header-cell *matHeaderCellDef></th>
          <td class="th-width-30 content-align" mat-cell *matCellDef="let item">
            <div *ngIf="item?.applicationStatus == 'Draft'" class="th-padding">
              <fa-icon [icon]="['far', 'trash-alt']" (click)="itemDelete(item)"></fa-icon>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row [ngStyle]="{ height: '40px' }" *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row (click)="loadNavi(row.id, row)" *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </div>

  <div fxLayoutAlign="center center" *ngIf="isLoading">
    <svg version="1.1" id="L4" width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 0 0"
      xml:space="preserve">
      <circle fill="#F46523" stroke="none" cx="6" cy="50" r="6">
        <animate attributeName="opacity" dur="1s" values="0;1;0" repeatCount="indefinite" begin="0.1" />
      </circle>
      <circle fill="#F46523" stroke="none" cx="26" cy="50" r="6">
        <animate attributeName="opacity" dur="1s" values="0;1;0" repeatCount="indefinite" begin="0.2" />
      </circle>
      <circle fill="#F46523" stroke="none" cx="46" cy="50" r="6">
        <animate attributeName="opacity" dur="1s" values="0;1;0" repeatCount="indefinite" begin="0.3" />
      </circle>
    </svg>
  </div>
</div>
